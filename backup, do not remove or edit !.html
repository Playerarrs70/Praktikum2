<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Warung Aslabkom ‚Äî Pesan Makanan</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <style>
    :root {--bg: #0f1724; --card: #0b1220; --accent: #b94a48;}
    body { background: var(--bg); color: #e6eef6; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    .glass { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(6px); }
    .btn-accent { background: var(--accent); color: white; transition: all .2s ease; }
    .btn-accent:hover { background: #963f3e; transform: scale(1.03); }
    .cart-badge { top: -8px; right: -10px; }
    .modal-backdrop { background: rgba(2,6,23,0.75); }
  </style>
</head>

<body class="antialiased">

    <header class="py-4 px-4 sm:px-8 flex flex-wrap gap-4 items-center justify-between glass">
    <div class="flex items-center gap-3 sm:gap-4">
      <img src="asset/logoaslabkom.png" alt="Logo" class="h-10 sm:h-12 w-auto" />
      <div>
        <h1 class="text-lg sm:text-xl font-bold leading-tight">Warung Aslabkom</h1>
        <p class="text-xs sm:text-sm text-gray-400">Nikmati Cita Rasa Terbaik di Kota Anda</p>
      </div>
    </div>
    <button id="btn-open-cart" class="relative p-2 sm:p-3 rounded-lg glass hover:scale-105 transition">
      <i class="fas fa-shopping-cart text-base sm:text-lg"></i>
      <span id="cartCount" class="absolute cart-badge bg-red-500 text-white rounded-full w-5 h-5 sm:w-6 sm:h-6 text-[10px] sm:text-xs flex items-center justify-center font-bold">0</span>
    </button>
  </header>

  <section class="py-10 px-4 sm:px-8">
  <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center gap-8 md:gap-12">
    <div class="flex-1 text-center md:text-left">
      <h2 class="text-3xl sm:text-4xl font-bold mb-4 leading-snug">Pesan cepat, antar cepet langsung dari lab.</h2>
      <p class="text-gray-400 mb-6 text-sm sm:text-base max-w-lg mx-auto md:mx-0">
        Pilih menu, tambahkan ke keranjang, lakukan pembayaran lewat QRIS, lalu klik ‚ÄúSaya sudah bayar‚Äù. Voila! Makanan akan diantarkan.
      </p>
      <button id="btn-scroll-products" class="btn-accent px-5 sm:px-6 py-3 rounded-md font-medium">
        <i class="fas fa-utensils mr-2"></i> Lihat Menu
      </button>
    </div>
    <div class="flex-1 w-full">
      <img src="asset/maskot.png" alt="hero" class="w-full max-w-sm sm:max-w-md mx-auto rounded-xl shadow-lg" />
    </div>
  </div>
  </section>

  <section id="products" class="py-10 px-4 sm:px-8">
  <div class="max-w-6xl mx-auto">
    <h3 class="text-xl sm:text-2xl font-bold mb-6 text-center md:text-left">Produk Unggulan</h3>

    <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <template id="product-template">
        <div class="prod-card glass rounded-xl overflow-hidden shadow-lg flex flex-col transition hover:scale-[1.02]">
          <img class="w-full h-40 sm:h-48 object-cover" src="asset/steakkentang.jpg" alt="produk" />
          <div class="p-4 flex-1 flex flex-col">
            <h4 class="font-semibold text-base sm:text-lg product-name">Chicken Steak</h4>
            <p class="text-xs sm:text-sm text-gray-400 mt-1 product-desc">Ayam juicy + kentang, pilihan BBQ / Blackpepper.</p>
            <div class="mt-4 flex items-center justify-between">
              <div class="product-price text-sm sm:text-base text-gray-300">Rp 25.000</div>
              <button class="btn-add btn-accent px-3 py-1 sm:px-4 sm:py-2 rounded-md text-xs sm:text-sm"><i class="fa-solid fa-cart-plus mr-1"></i>Tambah</button>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>
  </section>

  <footer class="py-10 px-6 sm:px-10 mt-12 glass">
  <div class="max-w-6xl mx-auto text-gray-400 text-center sm:text-left">
    <div class="flex flex-col sm:flex-row justify-between gap-4">
      <div>
        <h5 class="font-semibold text-white">Kontak</h5>
        <p class="text-sm">Michael Christia Putra ‚Äî 
          <a href="https://wa.me/+6281338599640" class="text-rose-400 hover:text-rose-300">0813-3859-9640</a>
        </p>
      </div>
      <div class="text-sm">¬© 2025 Aslabkom. All Right Reserved.</div>
    </div>
  </div>
  </footer>

  <div id="modal-cart" class="fixed inset-0 z-50 hidden items-center justify-center p-4 sm:p-6">
  <div class="absolute inset-0 modal-backdrop" onclick="closeCart()"></div>
  <div class="relative w-full max-w-3xl mx-auto bg-gradient-to-br from-neutral-900 to-neutral-800 rounded-xl p-5 sm:p-8 glass shadow-xl overflow-y-auto max-h-[90vh]">
    <div class="flex flex-wrap items-start justify-between gap-3">
      <h3 class="text-lg sm:text-xl font-bold">Keranjang Anda</h3>
      <div class="flex gap-2 sm:gap-3 items-center">
        <button class="text-xs sm:text-sm text-gray-300" onclick="clearCart()">Kosongkan</button>
        <button class="text-2xl leading-none" onclick="closeCart()">&times;</button>
      </div>
    </div>

    <div id="cartItems" class="mt-4 max-h-60 overflow-auto space-y-3 text-sm sm:text-base"></div>

    <div class="mt-4">
      <label class="block text-sm font-medium text-gray-300 mb-1">Note Order</label>
      <textarea id="noteOrder" class="w-full p-3 rounded-md bg-neutral-900 text-gray-100 text-sm sm:text-base" placeholder="Contoh: extra sambal, pisah sambal, dsb."></textarea>
    </div>

    <form id="checkoutForm" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm sm:text-base">
      <div>
        <label class="text-sm text-gray-300">Nama</label>
        <input required id="inputNama" class="w-full p-3 rounded-md bg-neutral-900 text-gray-100" placeholder="Nama pemesan" />
      </div>
      <div>
        <label class="text-sm text-gray-300">No. Tlp</label>
        <input required id="inputPhone" class="w-full p-3 rounded-md bg-neutral-900 text-gray-100" placeholder="08xxxxxxxxxx" />
      </div>
      <div class="sm:col-span-2">
        <label class="text-sm text-gray-300">Alamat Pengantaran</label>
        <textarea required id="inputAlamat" class="w-full p-3 rounded-md bg-neutral-900 text-gray-100" placeholder="Alamat lengkap"></textarea>
      </div>
    </form>

    <div class="mt-6 flex flex-col sm:flex-row justify-end gap-3">
      <button class="px-4 py-2 rounded-md bg-white text-black font-semibold" onclick="closeCart()">Tutup</button>
      <button id="btnProceedPayment" class="px-4 py-2 rounded-md btn-accent font-semibold" onclick="openQR()">Lanjut ke Pembayaran</button>
    </div>
  </div>
  </div>

  <div id="modal-qris" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
  <div class="absolute inset-0 modal-backdrop" onclick="closeQR()"></div>
  <div class="relative w-full max-w-sm sm:max-w-md mx-auto bg-gradient-to-br from-neutral-900 to-neutral-800 rounded-xl p-6 glass text-center shadow-xl">
    <div class="flex justify-between items-center mb-3">
      <h3 class="text-lg sm:text-xl font-bold">Pembayaran QRIS</h3>
      <button class="text-2xl" onclick="closeQR()">&times;</button>
    </div>
    <img id="qrisImage" src="asset/qris.jpg" class="w-48 h-48 sm:w-56 sm:h-56 mx-auto rounded-md object-contain" />
    <p class="text-gray-400 text-sm sm:text-base mt-3">Scan QR untuk membayar.</p>
    <div id="totalQris" class="mt-6">
      <div class="text-xs sm:text-sm text-gray-400">Total pembayaran:</div>
      <div id="totalAmountQris" class="font-bold text-lg sm:text-2xl text-white">Rp 0</div>
    </div>
    <div class="mt-6 flex flex-col sm:flex-row justify-center gap-3">
      <button id="btnPaid" class="px-4 py-2 rounded-md btn-accent font-semibold">‚úÖ Saya sudah bayar</button>
      <button class="px-4 py-2 rounded-md bg-white text-black font-semibold" onclick="closeQR()">üîô Kembali</button>
    </div>
  </div>
  </div>

  <div id="modal-success" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
  <div class="absolute inset-0 modal-backdrop" onclick="closeSuccess()"></div>
  <div class="relative w-full max-w-sm sm:max-w-md mx-auto bg-gradient-to-br from-neutral-900 to-neutral-800 rounded-xl p-8 glass text-center shadow-xl">
    <div class="mx-auto mb-4 text-green-400 text-6xl sm:text-7xl"><i class="fa-solid fa-check-circle"></i></div>
    <h3 class="text-xl sm:text-2xl font-bold">Pesanan Anda Tercatat</h3>
    <p class="text-gray-300 text-sm sm:text-base mt-2">Terima kasih sudah order di Warung Aslabkom üíñ</p>
    <button onclick="closeSuccess()" class="mt-5 px-5 py-2 rounded-md btn-accent font-semibold">Selesai</button>
  </div>
  </div>

  <script>
  /******************************************************
   * CONFIG
   ******************************************************/
  const GFORM_ENDPOINT = "https://docs.google.com/forms/d/e/1FAIpQLSfKk2A6o0m9rxp98VGNrEMM4EJjci-0WITkYPxGignd6haf3g/formResponse";

  // mapping product keys to Google Form entry IDs
  const FORM_FIELD_MAP = {
    "chicken_steak_qty": "entry.401470192",
    "chicken_steak_note": "entry.356445602",
    "chicken_katsu_qty": "entry.1870923223",
    "chicken_katsu_note": "entry.1295955232",
    "korean_spicy_qty": "entry.1745029511",
    "korean_spicy_note": "entry.549625584",
    "pempek_qty": "entry.639465876",
    "nama": "entry.1190731246",
    "notlp": "entry.1661635769",
    "alamat": "entry.1060037232",
    "note_order": "entry.1974325508",
    "note_pengantaran": "entry.1616149972"
  };

  /******************************************************
   * PRODUCTS
   ******************************************************/
  const PRODUCTS = [
    { id: "chicken_steak", name: "Chicken Steak (BBQ/BlackPepper) with (Kentang/Nasi)", price: 18000, img: "asset/steakkentang.jpg", qtyField: "chicken_steak_qty", noteField: "chicken_steak_note" },
    { id: "chicken_katsu", name: "Chicken Katsu", price: 15000, img: "asset/katsu.jpg", qtyField: "chicken_katsu_qty", noteField: "chicken_katsu_note" },
    { id: "korean_spicy", name: "Korean (Spicy/BBQ)", price: 18000, img: "asset/korean.jpg", qtyField: "korean_spicy_qty", noteField: "korean_spicy_note" },
    { id: "pempek_megalodon", name: "Pempek Megalodon", price: 21000, img: "asset/pempek.jpg", qtyField: "pempek_qty", noteField: null }
  ];

  /******************************************************
   * CART (stored in localStorage)
   ******************************************************/
  const CART_KEY = "warung_aslabkom_cart_v1";

  function loadCart() {
    try {
      const raw = localStorage.getItem(CART_KEY);
      if (!raw) return [];
      return JSON.parse(raw);
    } catch (e) {
      console.error("loadCart error", e);
      return [];
    }
  }
  function saveCart(cart) {
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
    updateCartBadge();
  }

  function findProductById(id) {
    return PRODUCTS.find(p => p.id === id);
  }

  function addToCart(productId) {
    const cart = loadCart();
    const existing = cart.find(i => i.id === productId);
    if (existing) {
      existing.qty = existing.qty + 1;
    } else {
      cart.push({ id: productId, qty: 1, note: "" });
    }
    saveCart(cart);
    showAddToast("Produk ditambahkan ke keranjang");
    renderCartItems();
  }

  function removeFromCart(productId) {
    let cart = loadCart();
    cart = cart.filter(i => i.id !== productId);
    saveCart(cart);
    renderCartItems();
  }

  function updateQty(productId, qty) {
    const cart = loadCart();
    const item = cart.find(i => i.id === productId);
    if (!item) return;
    item.qty = Math.max(0, parseInt(qty) || 0);
    if (item.qty === 0) {
      removeFromCart(productId);
    } else {
      saveCart(cart);
      renderCartItems();
    }
  }

  function updateNote(productId, note) {
    const cart = loadCart();
    const item = cart.find(i => i.id === productId);
    if (!item) return;
    item.note = note;
    saveCart(cart);
  }

  function clearCart() {
    localStorage.removeItem(CART_KEY);
    updateCartBadge();
    renderCartItems();
  }

  function updateCartBadge() {
    const cart = loadCart();
    const total = cart.reduce((s,i) => s + i.qty, 0);
    document.getElementById("cartCount").textContent = total;
  }

  /******************************************************
   * UI: render product grid from PRODUCTS
   ******************************************************/
  function renderProducts() {
    const grid = document.getElementById("productGrid");
    const template = document.getElementById("product-template").content;
    grid.innerHTML = "";
    PRODUCTS.forEach(p => {
      const node = template.cloneNode(true);
      node.querySelector(".product-name").textContent = p.name;
      node.querySelector(".product-desc").textContent = p.name;
      const priceEl = node.querySelector(".product-price");
      if (priceEl) priceEl.textContent = `Rp ${p.price.toLocaleString()}`;
      const img = node.querySelector("img");
      if (p.img) img.src = p.img;
      const btn = node.querySelector(".btn-add");
      btn.addEventListener("click", () => addToCart(p.id));
      grid.appendChild(node);
    });
  }

  /******************************************************
   * CART UI render
   ******************************************************/
  function renderCartItems() {
    const container = document.getElementById("cartItems");
    const cart = loadCart();
    container.innerHTML = "";
    if (cart.length === 0) {
      container.innerHTML = '<p class="text-gray-400">Keranjang kosong. Tambahkan produk dulu ya üòÑ</p>';
      return;
    }

    cart.forEach(item => {
      const prod = findProductById(item.id);
      const row = document.createElement("div");
      row.className = "flex items-start gap-4 bg-neutral-900 p-3 rounded-md";

      // image
      const img = document.createElement("img");
      img.src = prod.img || "";
      img.alt = prod.name;
      img.className = "w-16 h-16 object-cover rounded";

      // body
      const body = document.createElement("div");
      body.className = "flex-1";

      const titleRow = document.createElement("div");
      titleRow.className = "flex items-center justify-between";
      const title = document.createElement("div");
      title.innerHTML = `<div class="font-medium">${prod.name}</div><div class="text-sm text-gray-400">Rp ${prod.price.toLocaleString()}</div>`;
      const removeBtn = document.createElement("button");
      removeBtn.className = "text-sm text-red-400";
      removeBtn.innerHTML = "<i class='fa-solid fa-trash'></i>";
      removeBtn.addEventListener("click", () => removeFromCart(item.id));
      titleRow.appendChild(title);
      titleRow.appendChild(removeBtn);

      const controls = document.createElement("div");
      controls.className = "mt-2 flex items-center gap-3";

      const minus = document.createElement("button");
      minus.className = "px-2 py-1 bg-neutral-800 rounded text-gray-200";
      minus.innerHTML = "<i class='fa-solid fa-minus'></i>";
      minus.addEventListener("click", () => updateQty(item.id, item.qty - 1));

      const qtyInput = document.createElement("input");
      qtyInput.type = "number";
      qtyInput.min = "0";
      qtyInput.value = item.qty;
      qtyInput.className = "w-20 bg-neutral-900 p-2 rounded text-center";
      qtyInput.addEventListener("change", (e) => updateQty(item.id, parseInt(e.target.value || 0)));

      const plus = document.createElement("button");
      plus.className = "px-2 py-1 bg-neutral-800 rounded text-gray-200";
      plus.innerHTML = "<i class='fa-solid fa-plus'></i>";
      plus.addEventListener("click", () => updateQty(item.id, item.qty + 1));

      controls.appendChild(minus);
      controls.appendChild(qtyInput);
      controls.appendChild(plus);

      body.appendChild(titleRow);
      body.appendChild(controls);

      // note per item
      if (prod.noteField) {
        const noteArea = document.createElement("textarea");
        noteArea.placeholder = "Catatan untuk item (opsional)";
        noteArea.className = "mt-3 w-full p-2 bg-neutral-900 rounded text-gray-100";
        noteArea.value = item.note || "";
        noteArea.addEventListener("input", (e) => updateNote(item.id, e.target.value));
        body.appendChild(noteArea);
      }

      row.appendChild(img);
      row.appendChild(body);
      container.appendChild(row);
    });

    // total is computed for usage in QR modal but not displayed here intentionally
  }

  /******************************************************
   * TOAST
   ******************************************************/
  let toastTimer = null;
  function showAddToast(msg) {
    const t = document.createElement("div");
    t.className = "fixed right-6 bottom-6 bg-green-600 text-white px-4 py-2 rounded shadow-lg";
    t.textContent = msg;
    document.body.appendChild(t);
    if (toastTimer) clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
      t.remove();
    }, 1600);
  }

  /******************************************************
   * MODAL controls
   ******************************************************/
  function openCart() {
    document.getElementById("modal-cart").classList.remove("hidden");
    document.getElementById("modal-cart").classList.add("flex");
    renderCartItems();
  }
  function closeCart() {
    document.getElementById("modal-cart").classList.remove("flex");
    document.getElementById("modal-cart").classList.add("hidden");
  }

  function updateTotalAtQRIS() {
    const cart = loadCart();
    const total = cart.reduce((s, i) => {
      const prod = findProductById(i.id);
      return s + (prod ? prod.price * i.qty : 0);
    }, 0);
    const el = document.getElementById("totalAmountQris");
    if (el) el.textContent = "Rp " + total.toLocaleString();
  }

  function openQR() {
    const cart = loadCart();
    if (cart.length === 0) { alert("Keranjang kosong ‚Äî tambahkan produk dulu."); return; }
    const nama = document.getElementById("inputNama").value.trim();
    const phone = document.getElementById("inputPhone").value.trim();
    const alamat = document.getElementById("inputAlamat").value.trim();
    if (!nama || !phone || !alamat) { alert("Isi Nama, No. Tlp, dan Alamat terlebih dahulu."); return; }

    updateTotalAtQRIS();

    document.getElementById("modal-cart").classList.add("hidden");
    document.getElementById("modal-qris").classList.remove("hidden");
    document.getElementById("modal-qris").classList.add("flex");
  }
  function closeQR() {
    document.getElementById("modal-qris").classList.add("hidden");
    document.getElementById("modal-qris").classList.remove("flex");
    document.getElementById("modal-cart").classList.remove("hidden");
    document.getElementById("modal-cart").classList.add("flex");
  }
  function openSuccess() {
    document.getElementById("modal-success").classList.remove("hidden");
    document.getElementById("modal-success").classList.add("flex");
  }
  function closeSuccess() {
    document.getElementById("modal-success").classList.add("hidden");
    document.getElementById("modal-success").classList.remove("flex");
  }

  /******************************************************
   * SUBMIT to Google Form
   ******************************************************/
  async function submitToGForm() {
    const cart = loadCart();
    const payload = {};

    // initialize known fields (so they always appear)
    payload[FORM_FIELD_MAP["chicken_steak_qty"]] = "0";
    payload[FORM_FIELD_MAP["chicken_steak_note"]] = "";
    payload[FORM_FIELD_MAP["chicken_katsu_qty"]] = "0";
    payload[FORM_FIELD_MAP["chicken_katsu_note"]] = "";
    payload[FORM_FIELD_MAP["korean_spicy_qty"]] = "0";
    payload[FORM_FIELD_MAP["korean_spicy_note"]] = "";
    payload[FORM_FIELD_MAP["pempek_qty"]] = "0";

    // fill from cart
    cart.forEach(item => {
      const prod = findProductById(item.id);
      if (!prod) return;
      if (prod.qtyField && FORM_FIELD_MAP[prod.qtyField]) {
        payload[FORM_FIELD_MAP[prod.qtyField]] = String(item.qty || 0);
      }
      if (prod.noteField && FORM_FIELD_MAP[prod.noteField]) {
        payload[FORM_FIELD_MAP[prod.noteField]] = item.note || "";
      }
    });

    // other fields
    payload[FORM_FIELD_MAP["nama"]] = document.getElementById("inputNama").value.trim();
    payload[FORM_FIELD_MAP["notlp"]] = document.getElementById("inputPhone").value.trim();
    payload[FORM_FIELD_MAP["alamat"]] = document.getElementById("inputAlamat").value.trim();
    payload[FORM_FIELD_MAP["note_order"]] = document.getElementById("noteOrder").value.trim();
    // the delivery note field might not be used, set to empty if present
    if (FORM_FIELD_MAP["note_pengantaran"]) payload[FORM_FIELD_MAP["note_pengantaran"]] = "";

    const params = new URLSearchParams();
    Object.keys(payload).forEach(k => {
      params.append(k, payload[k]);
    });

    try {
      await fetch(GFORM_ENDPOINT, {
        method: "POST",
        body: params,
        mode: "no-cors"
      });

      clearCart();
      closeQR();
      openSuccess();
    } catch (err) {
      console.error("Submit error", err);
      alert("Gagal mengirim pesanan. Silakan coba lagi.");
    }
  }

  /******************************************************
   * initial setup
   ******************************************************/
  renderProducts();
  document.getElementById("btn-open-cart").addEventListener("click", openCart);
  document.getElementById("btnPaid").addEventListener("click", async () => {
    const btn = document.getElementById("btnPaid");
    btn.disabled = true;
    const originalText = btn.textContent;
    btn.textContent = "Mengirim pesanan...";
    await submitToGForm();
    btn.disabled = false;
    btn.textContent = originalText || "‚úÖ Saya sudah bayar";
  });

  document.getElementById("btn-scroll-products").addEventListener("click", () => {
    document.getElementById("products").scrollIntoView({ behavior: "smooth" });
  });

  updateCartBadge();
  renderCartItems();

  // optional subtle animation (non-blocking)
  setInterval(() => {
    document.querySelectorAll(".prod-card").forEach((el, idx) => {
      el.classList.toggle("animate__animated");
      el.classList.toggle("animate__pulse");
      setTimeout(() => {
        el.classList.toggle("animate__animated");
        el.classList.toggle("animate__pulse");
      }, 600 * (idx % 3));
    });
  }, 7000);
  </script>
</body>
</html>
